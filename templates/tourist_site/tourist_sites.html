{% include "head.html" %}

<body id="protectedBody" style="display: none;">


    {% include "partials/navbar.html" %}


    <div class="container mt-4">
        <h2 class="mb-4 mt-3">Sitios Tur√≠sticos Creados</h2>

        <h3 class="admin-only">¬øQu√© deseas hacer?</h3>
        <a href="/tourist_sites/add" class="btn btn-primary mb-2 admin-only">Agregar sitio tur√≠stico</a>
        <a href="/tourist_sites/edit" class="btn btn-warning mb-2 text-white admin-only">Editar sitio tur√≠stico</a>
        <a href="/tourist_sites/delete" class="btn btn-danger mb-2 admin-only">Eliminar sitio tur√≠stico</a>


        <div class="row row-cols-1 row-cols-md-3 g-4 mt-4">
            {% for site in sites %}
            <div class="col">
                <div class="card h-100 shadow-sm border-0">
                    {% if site.photo %}
                    <img src="{{ url_for('static', filename='tourist_sites_images/' ~ site.photo) }}"
                        class="card-img-top site-photo" alt="{{ site.name }}"
                        style="height: 200px; object-fit: cover; cursor: pointer;" data-bs-toggle="modal"
                        data-bs-target="#imageModal"
                        data-img-src="{{ url_for('static', filename='tourist_sites_images/' ~ site.photo) }}"
                        data-img-name="{{ site.name }}">
                    {% else %}
                    <div class="bg-light text-muted text-center py-5">Sin imagen</div>
                    {% endif %}
                    <div class="card-body">
                        <a href="{{ url_for('feedback_bp.feedback_add_form', site_id=site.id_tourist_site) }}"
                            class="btn btn-success btn-sm tourist-only">
                            <i class="bi bi-chat-dots"></i> Comentar
                        </a>

                        <h5 class="card-title text-primary">{{ site.name }}</h5>

                        Descripcion:
                        <p class="card-text">{{ site.description }}</p>

                        <p class="text-muted mb-1">
                            Direccion:
                            <i class="bi bi-geo-alt-fill"></i> {{ site.address }}
                        </p>
                        <p class="text-muted mb-1">
                            Contacto/s:
                            <i class="bi bi-telephone-fill"></i> {{ site.phone }}
                        </p>
                        <p class="text-muted mb-1">
                            Horarios:
                            <i class="bi bi-clock"></i> {{ site.opening_hours }} - {{ site.closing_hours }}
                        </p>
                        <p class="text-muted mb-1">
                            <i class="bi bi-bar-chart-line"></i>
                            Promedio visitas:
                            <strong>{{ "{:,.2f}".format(site.average or 0) }}</strong>
                        </p>
                        <p class="text-muted">
                            Categoria:
                            <i class="bi bi-tag-fill"></i> {{ site.category }}
                        </p>
                    </div>

                    <div class="card-footer bg-transparent d-flex justify-content-between align-items-center">
                        <div>
                            {% if site.url %}
                            <a href="{{ site.url }}" target="_blank" class="btn btn-outline-primary btn-sm me-2">
                                <i class="bi bi-box-arrow-up-right"></i> Ver sitio
                            </a>
                            {% endif %}

                            {% if not site.is_activate %}
                            <button class="btn btn-success btn-sm btn-reactivate admin-only"
                                data-id="{{ site.id_tourist_site }}">
                                <i class="bi bi-arrow-clockwise"></i> Reactivar
                            </button>
                            {% endif %}
                        </div>

                        {% if site.is_activate %}
                        <span class="badge bg-success">Activo</span>
                        {% else %}
                        <span class="badge bg-secondary">Inactivo</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!--  Modal Bootstrap para ver imagen ampliada -->
        <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="imageModalLabel">Vista ampliada</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>
                    <div class="modal-body text-center">
                        <img id="modalImage" src="" alt="" class="img-fluid rounded shadow">
                    </div>
                </div>
            </div>
        </div>

        <!-- üîπ Script JS del modal -->
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const modalImage = document.getElementById('modalImage');
                const modalTitle = document.getElementById('imageModalLabel');

                // Captura el click en cualquier imagen de la tabla
                document.querySelectorAll('.site-photo').forEach(img => {
                    img.addEventListener('click', () => {
                        const imgSrc = img.getAttribute('data-img-src');
                        const imgName = img.getAttribute('data-img-name');

                        modalImage.src = imgSrc;
                        modalTitle.textContent = `Vista ampliada - ${imgName}`;
                    });
                });
            });
        </script>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const role = localStorage.getItem('role');
                console.log("Rol detectado:", role);

                // Ocultamos los accesos con la clase "admin-only" si el usuario no es administrador
                if (role !== 'admin') {
                    document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'none');
                }
            });
        </script>

</body>

<script src="/static/tourist_sites/tourist_sites.js"></script>
{% include "scripts.html" %}