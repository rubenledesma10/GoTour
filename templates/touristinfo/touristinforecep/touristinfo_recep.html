{% include "head.html" %}

<body>
{% include "partials/navbar.html" %}

<div id="protectedBody" style="display: none;">
    <div class="container mt-4">

        <h2 class="mb-4">Información Turística - Receptionist</h2>

        <!-- Botón agregar solo visible para receptionist -->
        <div class="mb-3">
            <button id="btnShowAdd" class="btn btn-primary d-none" data-role="receptionist">Agregar</button>
        </div>

        <!-- Tabla información -->
        <table class="table table-striped table-bordered mt-3">
            <thead class="table-dark text-center">
                <tr>
                    <th>Nacionalidad</th>
                    <th>Provincia</th>
                    <th>Cantidad</th>
                    <th>Movilidad</th>
                    <th>Personas con discapacidad</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for tourist in tourists %}
                <tr data-id="{{ tourist.id_turist }}">
                    <td>{{ tourist.nationality }}</td>
                    <td>{{ tourist.province }}</td>
                    <td>{{ tourist.quantity }}</td>
                    <td>{{ tourist.mobility }}</td>
                    <td>{{ tourist.person_with_disability }}</td>
                    <td class="text-center">
                        <button class="btn btn-sm btn-warning btnEdit d-none" data-role="receptionist">Editar</button>
                        <button class="btn btn-sm btn-danger btnDelete d-none" data-role="receptionist">Eliminar</button>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6">No hay turistas cargados</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

    </div>
</div>

<!-- Formulario flotante agregar -->
<div class="floating-form d-none" id="addFormContainer" data-role="receptionist">
    <div class="card p-4 shadow-lg rounded-4">
        <h4 class="text-primary mb-3">Agregar Información Turística</h4>
        <form id="formAddTourist">
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="nationality" class="form-label">Nacionalidad</label>
                    <input type="text" class="form-control" id="nationality" name="nationality" placeholder="Ej: Argentina" required>
                </div>
                <div class="col-md-6">
                    <label for="province" class="form-label">Provincia</label>
                    <input type="text" class="form-control" id="province" name="province" placeholder="Ej: Mendoza" required>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="quantity" class="form-label">Cantidad de Personas</label>
                    <input type="number" class="form-control" id="quantity" name="quantity" required>
                </div>
                <div class="col-md-6">
                    <label for="person_with_disability" class="form-label">Personas con Discapacidad</label>
                    <input type="number" class="form-control" id="person_with_disability" name="person_with_disability" required>
                </div>
            </div>
            <div class="mb-3">
                <label for="mobility" class="form-label">Movilidad</label>
                <input type="text" class="form-control" id="mobility" name="mobility" required>
            </div>
            <div class="d-flex justify-content-between mt-4">
                <button type="button" id="btnCancelAdd" class="btn btn-secondary">Cancelar</button>
                <button type="submit" class="btn btn-primary">Guardar</button>
            </div>
        </form>
    </div>
</div>

<!-- Formulario flotante editar -->
<div class="floating-form d-none" id="editFormContainer" data-role="receptionist">
    <div class="card p-4 shadow-lg rounded-4">
        <h4 class="text-warning mb-3">Editar Información Turística</h4>
        <form id="formEditTourist">
            <input type="hidden" id="editId">
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="editNationality" class="form-label">Nacionalidad</label>
                    <input type="text" class="form-control" id="editNationality" name="editNationality" required>
                </div>
                <div class="col-md-6">
                    <label for="editProvince" class="form-label">Provincia</label>
                    <input type="text" class="form-control" id="editProvince" name="editProvince" required>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="editQuantity" class="form-label">Cantidad de Personas</label>
                    <input type="number" class="form-control" id="editQuantity" name="editQuantity" required>
                </div>
                <div class="col-md-6">
                    <label for="editDisability" class="form-label">Personas con Discapacidad</label>
                    <input type="number" class="form-control" id="editDisability" name="editDisability" required>
                </div>
            </div>
            <div class="mb-3">
                <label for="editMobility" class="form-label">Movilidad</label>
                <input type="text" class="form-control" id="editMobility" name="editMobility" required>
            </div>
            <div class="d-flex justify-content-between mt-4">
                <button type="button" id="btnCancelEdit" class="btn btn-secondary">Cancelar</button>
                <button type="submit" class="btn btn-primary">Actualizar</button>
            </div>
        </form>
    </div>
</div>

<style>
.floating-form {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 500px;
    max-width: 90%;
    z-index: 1050;
    background-color: white;
    border-radius: 1rem;
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    padding: 20px;
    display: none; /* oculto por defecto */
}
.floating-form .card {
    margin: 0;
    border: none;
    box-shadow: none;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const addForm = document.getElementById('addFormContainer');
    const editForm = document.getElementById('editFormContainer');

    // asegurarse de que estén ocultos al inicio
    addForm.style.display = 'none';
    editForm.style.display = 'none';

    const role = (localStorage.getItem('role') || '').toLowerCase();

    if (role === 'receptionist') {
        document.getElementById('btnShowAdd').classList.remove('d-none');
        document.querySelectorAll('.btnEdit, .btnDelete').forEach(btn => btn.classList.remove('d-none'));
    }

    // Abrir formulario agregar
    document.getElementById('btnShowAdd').addEventListener('click', () => {
        addForm.style.display = 'block';
    });
    document.getElementById('btnCancelAdd').addEventListener('click', () => {
        addForm.style.display = 'none';
    });

    // Abrir formulario editar
    document.querySelectorAll('.btnEdit').forEach(btn => {
        btn.addEventListener('click', e => {
            const row = e.target.closest('tr');
            const id = row.dataset.id;

            document.getElementById('editId').value = id;
            document.getElementById('editNationality').value = row.children[0].innerText;
            document.getElementById('editProvince').value = row.children[1].innerText;
            document.getElementById('editQuantity').value = row.children[2].innerText;
            document.getElementById('editDisability').value = row.children[4].innerText;
            document.getElementById('editMobility').value = row.children[3].innerText;

            editForm.style.display = 'block';
        });
    });
    document.getElementById('btnCancelEdit').addEventListener('click', () => {
        editForm.style.display = 'none';
    });
});
</script>


<!-- JS específicos -->
<script src="/static/recep_touristinfo.js/touristinfo_recep.js"></script>
<script src="/static/recep_touristinfo.js/touristinfo_add_recep.js"></script>
<script src="/static/recep_touristinfo.js/touristinfo_edit_recep.js"></script>
<script src="/static/recep_touristinfo.js/touristinfo_delete_recep.js"></script>

{% include "scripts.html" %}
</body>
